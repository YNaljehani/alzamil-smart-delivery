<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASDP - Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <link href="css/shared.css" rel="stylesheet">
    <link href="css/dashboard.css" rel="stylesheet">
</head>
<body>

    <!-- ========== NAVBAR ========== -->
    <nav class="asdp-navbar">
        <a href="index.html" class="nav-brand">
            <span class="logo-icon">ğŸš›</span>
            <span>ASDP</span>
        </a>
        <ul class="nav-links">
            <li><a href="index.html"><i class="bi bi-house"></i> Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
            <li><a href="sra-form.html"><i class="bi bi-clipboard-check"></i> ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…ÙˆÙ‚Ø¹</a></li>
            <li><a href="dashboard.html"><i class="bi bi-grid-1x2"></i> Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a></li>
            <li><a href="tracking.html"><i class="bi bi-geo-alt"></i> Ø§Ù„ØªØªØ¨Ø¹</a></li>
            <li><a href="whatsapp.html"><i class="bi bi-whatsapp"></i> Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</a></li>
        </ul>
    </nav>

    <!-- ========== MAIN CONTENT ========== -->
    <div class="page-container" id="mainContent" style="display: none;">

        <!-- ===== SECTION 1: Header Bar ===== -->
        <div class="dashboard-header stagger-1">
            <div class="header-date">
                <i class="bi bi-calendar3"></i>
                <span id="todayDate"></span>
            </div>
            <div class="header-shift">
                <span>Ø§Ù„ÙˆØ±Ø¯ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©:</span>
                <span class="shift-badge">
                    <i class="bi bi-clock-fill"></i>
                    Ø§Ù„ØªØ­Ø¶ÙŠØ± (6Ù… - 9Ù…)
                </span>
            </div>
            <div class="header-user">
                <span>Ù…Ø¯ÙŠØ± Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</span>
                <div class="user-avatar">
                    <i class="bi bi-person-fill"></i>
                </div>
            </div>
        </div>

        <!-- ===== SECTION 2: KPI Cards ===== -->
        <div class="kpi-row stagger-2">
            <!-- KPI 1: Tonight's Deliveries -->
            <div class="kpi-card-dash kpi-blue">
                <div class="kpi-top">
                    <div class="kpi-icon-wrap">
                        <i class="bi bi-truck"></i>
                    </div>
                    <span class="kpi-delta-badge up">
                        <i class="bi bi-arrow-up-short"></i>
                        +20%
                    </span>
                </div>
                <div class="kpi-value-big" data-counter="12" data-suffix="">0</div>
                <div class="kpi-label-text">ØªÙˆØµÙŠÙ„Ø§Øª Ø§Ù„Ù„ÙŠÙ„Ø©</div>
            </div>

            <!-- KPI 2: Success Rate -->
            <div class="kpi-card-dash kpi-green">
                <div class="kpi-top">
                    <div class="kpi-icon-wrap">
                        <i class="bi bi-check-circle"></i>
                    </div>
                    <span class="kpi-delta-badge up">
                        <i class="bi bi-arrow-up-short"></i>
                        +8%
                    </span>
                </div>
                <div class="kpi-value-big" data-counter="94" data-suffix="%">0</div>
                <div class="kpi-label-text">Ù†Ø³Ø¨Ø© Ø§Ù„Ù†Ø¬Ø§Ø­</div>
            </div>

            <!-- KPI 3: Completed Assessments -->
            <div class="kpi-card-dash kpi-purple">
                <div class="kpi-top">
                    <div class="kpi-icon-wrap">
                        <i class="bi bi-clipboard-check"></i>
                    </div>
                    <span class="kpi-delta-badge up">
                        <i class="bi bi-arrow-up-short"></i>
                        +35%
                    </span>
                </div>
                <div class="kpi-value-big" data-counter="47" data-suffix="">0</div>
                <div class="kpi-label-text">ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ù…ÙƒØªÙ…Ù„Ø©</div>
            </div>

            <!-- KPI 4: Monthly Savings -->
            <div class="kpi-card-dash kpi-gold">
                <div class="kpi-top">
                    <div class="kpi-icon-wrap">
                        <i class="bi bi-cash-stack"></i>
                    </div>
                    <span class="kpi-delta-badge up">
                        <i class="bi bi-arrow-up-short"></i>
                        +15%
                    </span>
                </div>
                <div class="kpi-value-big" data-counter="1.2" data-suffix="M" data-decimal="true">0</div>
                <div class="kpi-label-text">Ø§Ù„ØªÙˆÙÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠ (Ø±.Ø³)</div>
            </div>
        </div>

        <!-- ===== SECTION 3: Night Shift Timeline ===== -->
        <div class="timeline-section stagger-3">
            <div class="section-title">
                <i class="bi bi-clock-history text-brand"></i>
                Ø¬Ø¯ÙˆÙ„ Ø§Ù„ÙˆØ±Ø¯ÙŠØ§Øª Ø§Ù„Ù„ÙŠÙ„ÙŠØ©
            </div>
            <div class="timeline-bar" id="timelineBar">
                <div class="timeline-segment prep">
                    <span class="segment-name">ØªØ­Ø¶ÙŠØ±</span>
                    <span class="segment-time">6Ù… - 9Ù…</span>
                </div>
                <div class="timeline-segment delivery">
                    <span class="segment-name">ØªÙˆØµÙŠÙ„</span>
                    <span class="segment-time">9Ù… - 5Øµ</span>
                </div>
                <div class="timeline-segment wrapup">
                    <span class="segment-name">Ø¥Ù†Ù‡Ø§Ø¡</span>
                    <span class="segment-time">5Øµ - 6Øµ</span>
                </div>
                <!-- Pulsing marker for current time -->
                <div class="timeline-marker" id="timeMarker"></div>
            </div>
            <div class="timeline-labels">
                <span>6:00 Ù…</span>
                <span>9:00 Ù…</span>
                <span>12:00 Øµ</span>
                <span>3:00 Øµ</span>
                <span>6:00 Øµ</span>
            </div>
        </div>

        <!-- ===== SECTION 4: Tonight's Delivery Queue ===== -->
        <div class="queue-section stagger-4" id="queueSection">
            <div class="section-header">
                <div class="section-title" style="margin-bottom: 0;">
                    <i class="bi bi-truck text-brand"></i>
                    Ø¬Ø¯ÙˆÙ„ ØªÙˆØµÙŠÙ„Ø§Øª Ø§Ù„Ù„ÙŠÙ„Ø©
                </div>
                <span class="badge-count" id="queueCount">0 ØªÙˆØµÙŠÙ„Ø§Øª</span>
            </div>
            <div class="queue-table-wrap">
                <table class="queue-table">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨</th>
                            <th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
                            <th>Ø§Ù„Ø­ÙŠ</th>
                            <th>Ø§Ù„Ø®Ø²Ø§Ù†</th>
                            <th>ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…ÙˆÙ‚Ø¹</th>
                            <th>ÙØ¦Ø© Ø§Ù„ØªÙˆØµÙŠÙ„</th>
                            <th>Ø§Ù„Ù…Ø±ÙƒØ¨Ø©</th>
                            <th>Ø§Ù„Ø³Ø§Ø¦Ù‚</th>
                            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                            <th>Ø§Ù„ÙˆØµÙˆÙ„ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹</th>
                        </tr>
                    </thead>
                    <tbody id="queueBody">
                        <!-- Populated by JS -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- ===== SECTION 5: SRA Score Distribution Charts ===== -->
        <div class="charts-row stagger-5">
            <!-- Chart 1: Doughnut -->
            <div class="chart-card">
                <div class="chart-title">
                    <i class="bi bi-pie-chart-fill text-brand"></i>
                    ØªÙˆØ²ÙŠØ¹ ØªÙ‚ÙŠÙŠÙ…Ø§Øª Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹
                </div>
                <div class="chart-wrapper doughnut-wrap">
                    <canvas id="scoreDistChart"></canvas>
                </div>
            </div>
            <!-- Chart 2: Bar -->
            <div class="chart-card">
                <div class="chart-title">
                    <i class="bi bi-bar-chart-fill text-brand"></i>
                    Ø§Ù„ØªÙˆØµÙŠÙ„Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ© (Ø¢Ø®Ø± 7 Ø£ÙŠØ§Ù…)
                </div>
                <div class="chart-wrapper">
                    <canvas id="dailyDeliveriesChart"></canvas>
                </div>
            </div>
        </div>

        <!-- ===== SECTION 6: Fleet Status ===== -->
        <div class="fleet-section stagger-6" id="fleetSection">
            <div class="section-title">
                <i class="bi bi-truck text-brand"></i>
                Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ø³Ø·ÙˆÙ„
            </div>
            <div class="fleet-grid" id="fleetGrid">
                <!-- Populated by JS -->
            </div>
        </div>

        <!-- Footer -->
        <div class="dashboard-footer">
            <p>MBSC MiM - Integrated Management Challenge | Hackathon Prototype</p>
            <p>Alzamil Smart Delivery Platform (ASDP) v1.0 - February 2026</p>
        </div>
    </div>

    <!-- ========== NO DATA WARNING ========== -->
    <div class="page-container" id="noDataWarning" style="display: none;">
        <div class="no-data-warning">
            <i class="bi bi-exclamation-triangle-fill"></i>
            <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©</h3>
            <p>ÙŠØ±Ø¬Ù‰ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ø£ÙˆÙ„Ø§Ù‹ Ù…Ù† Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„Ø¹Ø±Ø¶ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</p>
            <a href="index.html" class="btn-brand">
                <i class="bi bi-house"></i>
                Ø§Ù„Ø°Ù‡Ø§Ø¨ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
            </a>
        </div>
    </div>

    <!-- ========== SCRIPTS ========== -->
    <script src="js/shared.js"></script>
    <script src="js/scoring.js"></script>
    <script src="js/mock-data.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
    document.addEventListener('DOMContentLoaded', function() {

        // ---- 1. Check for demo data ----
        if (!ASDP.isDemoLoaded()) {
            document.getElementById('noDataWarning').style.display = 'block';
            document.getElementById('mainContent').style.display = 'none';
            return;
        }

        document.getElementById('mainContent').style.display = 'block';
        document.getElementById('noDataWarning').style.display = 'none';

        // ---- 2. Load all data from localStorage ----
        var orders = ASDP.storage.load('orders') || [];
        var fleet = ASDP.storage.load('fleet') || [];
        var assessments = ASDP.storage.load('assessments') || [];
        var tonightQueue = ASDP.storage.load('tonight_queue') || [];
        var kpiHistory = ASDP.storage.load('kpi_history') || {};

        // Build lookup maps
        var ordersMap = {};
        orders.forEach(function(o) { ordersMap[o.id] = o; });

        var fleetMap = {};
        fleet.forEach(function(v) { fleetMap[v.id] = v; });

        var assessmentsMap = {};
        assessments.forEach(function(a) { assessmentsMap[a.orderId] = a; });

        // ---- 3. Set Today's Date ----
        var todayEl = document.getElementById('todayDate');
        todayEl.textContent = new Intl.DateTimeFormat('ar-SA', {
            weekday: 'long',
            year: 'numeric',
            month: 'long',
            day: 'numeric'
        }).format(new Date());

        // ---- 4. Animate KPI Counters ----
        var counters = document.querySelectorAll('[data-counter]');
        counters.forEach(function(el) {
            var target = parseFloat(el.getAttribute('data-counter'));
            var suffix = el.getAttribute('data-suffix') || '';
            var isDecimal = el.getAttribute('data-decimal') === 'true';

            if (isDecimal) {
                // Animate decimal value
                var start = 0;
                var duration = 1500;
                var increment = target / (duration / 16);
                var timer = setInterval(function() {
                    start += increment;
                    if (start >= target) {
                        start = target;
                        clearInterval(timer);
                    }
                    el.textContent = start.toFixed(1) + suffix;
                }, 16);
            } else {
                ASDP.animateCounter(el, target, 1500, suffix);
            }
        });

        // ---- 5. Render Delivery Queue Table ----
        renderQueue(tonightQueue, ordersMap, fleetMap, assessmentsMap);

        // ---- 6. Initialize Charts ----
        initCharts(kpiHistory);

        // ---- 7. Render Fleet Cards ----
        renderFleet(fleet);

        // ---- 8. Position Timeline Marker ----
        positionTimelineMarker();
    });

    // ============================================================
    //  RENDER: Delivery Queue
    // ============================================================
    function renderQueue(queue, ordersMap, fleetMap, assessmentsMap) {
        var tbody = document.getElementById('queueBody');
        var countEl = document.getElementById('queueCount');
        tbody.innerHTML = '';

        countEl.textContent = queue.length + ' ØªÙˆØµÙŠÙ„Ø§Øª';

        queue.forEach(function(item, idx) {
            var order = ordersMap[item.orderId] || {};
            var vehicle = item.vehicleId ? (fleetMap[item.vehicleId] || {}) : {};
            var assessment = assessmentsMap[item.orderId] || {};

            var tr = document.createElement('tr');

            // Mark blocked rows
            if (item.status === 'blocked' || assessment.classification === 'BLACK') {
                tr.classList.add('row-blocked');
            }

            // # column
            var tdNum = document.createElement('td');
            tdNum.textContent = idx + 1;
            tdNum.style.fontWeight = '700';
            tdNum.style.color = '#6c757d';
            tr.appendChild(tdNum);

            // Order ID
            var tdOrder = document.createElement('td');
            tdOrder.innerHTML = '<span class="order-id">' + (order.id || item.orderId || '-') + '</span>';
            tr.appendChild(tdOrder);

            // Customer
            var tdCustomer = document.createElement('td');
            tdCustomer.innerHTML = '<span class="customer-name">' + (order.customer || '-') + '</span>';
            tr.appendChild(tdCustomer);

            // District
            var tdDistrict = document.createElement('td');
            tdDistrict.innerHTML = '<span class="district-name">' + (order.district || '-') + '</span>';
            tr.appendChild(tdDistrict);

            // Tank
            var tdTank = document.createElement('td');
            tdTank.textContent = order.tank || '-';
            tdTank.style.fontSize = '0.82rem';
            tr.appendChild(tdTank);

            // SRA Score Badge
            var tdScore = document.createElement('td');
            if (assessment.classification) {
                var scoreClass = assessment.classification.toLowerCase();
                var scoreLabel = ASDP.text.scores[assessment.classification]
                    ? ASDP.text.scores[assessment.classification].label
                    : assessment.classification;
                tdScore.innerHTML = '<span class="score-badge ' + scoreClass + '">' +
                    assessment.score + ' - ' + scoreLabel + '</span>';
            } else {
                tdScore.textContent = '-';
            }
            tr.appendChild(tdScore);

            // Delivery Class Badge
            var tdClass = document.createElement('td');
            if (assessment.deliveryClass) {
                var dc = assessment.deliveryClass;
                tdClass.innerHTML = '<span class="class-badge class-' + dc.toLowerCase() + '">' +
                    ASDP.text.classes[dc].label + '</span>';
            } else {
                tdClass.textContent = '-';
            }
            tr.appendChild(tdClass);

            // Vehicle
            var tdVehicle = document.createElement('td');
            if (item.vehicleId && vehicle.id) {
                tdVehicle.innerHTML = '<span class="vehicle-id">' + vehicle.id + '</span>';
            } else {
                tdVehicle.innerHTML = '<span style="color:#e74c3c; font-weight:700;">ØºÙŠØ± Ù…Ø­Ø¯Ø¯</span>';
            }
            tr.appendChild(tdVehicle);

            // Driver
            var tdDriver = document.createElement('td');
            tdDriver.textContent = vehicle.driver || '-';
            tdDriver.style.fontSize = '0.85rem';
            tr.appendChild(tdDriver);

            // Status
            var tdStatus = document.createElement('td');
            var statusHtml = buildStatusBadge(item.status);
            tdStatus.innerHTML = statusHtml;
            tr.appendChild(tdStatus);

            // ETA
            var tdEta = document.createElement('td');
            if (item.estimatedArrival) {
                tdEta.innerHTML = '<span class="arrival-time">' + item.estimatedArrival + '</span>';
            } else {
                tdEta.textContent = '-';
            }
            tr.appendChild(tdEta);

            tbody.appendChild(tr);
        });
    }

    function buildStatusBadge(status) {
        var labels = {
            loading: 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„',
            enroute: 'ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚',
            delivered: 'ØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„',
            pending: 'Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±',
            blocked: 'Ù…Ø­Ø¸ÙˆØ±'
        };
        var label = labels[status] || status;
        return '<span class="delivery-status status-' + status + '">' +
               '<span class="status-dot-sm"></span>' +
               label + '</span>';
    }

    // ============================================================
    //  RENDER: Charts
    // ============================================================
    function initCharts(kpiHistory) {
        var dist = kpiHistory.scoreDistribution || { GREEN: 62, YELLOW: 23, RED: 12, BLACK: 3 };

        // ----- Doughnut: Score Distribution -----
        var doughnutCtx = document.getElementById('scoreDistChart').getContext('2d');
        new Chart(doughnutCtx, {
            type: 'doughnut',
            data: {
                labels: ['Ø£Ø®Ø¶Ø±', 'Ø£ØµÙØ±', 'Ø£Ø­Ù…Ø±', 'Ø£Ø³ÙˆØ¯'],
                datasets: [{
                    data: [dist.GREEN, dist.YELLOW, dist.RED, dist.BLACK],
                    backgroundColor: ['#2ecc71', '#f39c12', '#e74c3c', '#2c3e50'],
                    borderWidth: 3,
                    borderColor: '#ffffff',
                    hoverBorderWidth: 0,
                    hoverOffset: 8
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                cutout: '62%',
                plugins: {
                    legend: {
                        position: 'right',
                        rtl: true,
                        textDirection: 'rtl',
                        labels: {
                            font: {
                                family: 'Tajawal',
                                size: 13,
                                weight: '600'
                            },
                            padding: 16,
                            usePointStyle: true,
                            pointStyleWidth: 12,
                            generateLabels: function(chart) {
                                var data = chart.data;
                                return data.labels.map(function(label, i) {
                                    var value = data.datasets[0].data[i];
                                    return {
                                        text: label + '  (' + value + '%)',
                                        fillStyle: data.datasets[0].backgroundColor[i],
                                        strokeStyle: data.datasets[0].backgroundColor[i],
                                        lineWidth: 0,
                                        hidden: false,
                                        index: i,
                                        pointStyle: 'circle'
                                    };
                                });
                            }
                        }
                    },
                    tooltip: {
                        rtl: true,
                        textDirection: 'rtl',
                        bodyFont: { family: 'Tajawal' },
                        titleFont: { family: 'Tajawal' },
                        callbacks: {
                            label: function(ctx) {
                                return ctx.label + ': ' + ctx.parsed + '%';
                            }
                        }
                    }
                },
                animation: {
                    animateRotate: true,
                    duration: 1200
                }
            }
        });

        // ----- Bar: Daily Deliveries -----
        var deliveries = kpiHistory.deliveries || [12, 15, 11, 18, 14, 16, 8];
        var days = kpiHistory.dates || ['Ø§Ù„Ø³Ø¨Øª', 'Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Ø§Ù„Ø¬Ù…Ø¹Ø©'];

        var barCtx = document.getElementById('dailyDeliveriesChart').getContext('2d');
        new Chart(barCtx, {
            type: 'bar',
            data: {
                labels: days,
                datasets: [{
                    label: 'Ø¹Ø¯Ø¯ Ø§Ù„ØªÙˆØµÙŠÙ„Ø§Øª',
                    data: deliveries,
                    backgroundColor: function(ctx) {
                        var gradient = barCtx.createLinearGradient(0, 0, 0, 300);
                        gradient.addColorStop(0, 'rgba(26, 82, 118, 0.9)');
                        gradient.addColorStop(1, 'rgba(41, 128, 185, 0.6)');
                        return gradient;
                    },
                    borderColor: '#1a5276',
                    borderWidth: 0,
                    borderRadius: 8,
                    borderSkipped: false,
                    maxBarThickness: 48
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                scales: {
                    x: {
                        grid: { display: false },
                        ticks: {
                            font: {
                                family: 'Tajawal',
                                size: 12,
                                weight: '600'
                            },
                            color: '#6c757d'
                        }
                    },
                    y: {
                        beginAtZero: true,
                        position: 'right',
                        grid: {
                            color: 'rgba(0,0,0,0.05)',
                            drawBorder: false
                        },
                        ticks: {
                            font: {
                                family: 'Tajawal',
                                size: 12,
                                weight: '600'
                            },
                            color: '#6c757d',
                            stepSize: 5
                        }
                    }
                },
                plugins: {
                    legend: {
                        position: 'right',
                        rtl: true,
                        textDirection: 'rtl',
                        labels: {
                            font: {
                                family: 'Tajawal',
                                size: 13,
                                weight: '600'
                            },
                            usePointStyle: true,
                            pointStyle: 'rectRounded'
                        }
                    },
                    tooltip: {
                        rtl: true,
                        textDirection: 'rtl',
                        bodyFont: { family: 'Tajawal' },
                        titleFont: { family: 'Tajawal' },
                        callbacks: {
                            label: function(ctx) {
                                return 'Ø§Ù„ØªÙˆØµÙŠÙ„Ø§Øª: ' + ctx.parsed.y;
                            }
                        }
                    }
                },
                animation: {
                    duration: 1000,
                    easing: 'easeOutQuart'
                }
            }
        });
    }

    // ============================================================
    //  RENDER: Fleet Cards
    // ============================================================
    function renderFleet(fleet) {
        var grid = document.getElementById('fleetGrid');
        grid.innerHTML = '';

        var typeIcons = {
            heavy: '\uD83D\uDE9B',
            light: '\uD83D\uDE99',
            crane: '\uD83C\uDFD7\uFE0F'
        };

        var statusLabels = {
            available: 'Ù…ØªØ§Ø­',
            enroute: 'ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚',
            loading: 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„',
            maintenance: 'ØµÙŠØ§Ù†Ø©',
            scheduled: 'Ù…Ø¬Ø¯ÙˆÙ„'
        };

        var statusClasses = {
            available: 'fs-available',
            enroute: 'fs-enroute',
            loading: 'fs-loading',
            maintenance: 'fs-maintenance',
            scheduled: 'fs-scheduled'
        };

        fleet.forEach(function(v) {
            var card = document.createElement('div');
            card.className = 'fleet-card';

            var icon = typeIcons[v.type] || '\uD83D\uDE9B';
            var statusLabel = statusLabels[v.status] || v.status;
            var statusClass = statusClasses[v.status] || 'fs-scheduled';

            var html = '';

            // Crane badge
            if (v.crane) {
                html += '<div class="crane-badge"><i class="bi bi-arrow-up-circle-fill"></i> Ø±Ø§ÙØ¹Ø©</div>';
            }

            html += '<div class="fleet-icon">' + icon + '</div>';
            html += '<div class="fleet-vehicle-id">' + v.id + '</div>';
            html += '<div class="fleet-vehicle-name">' + v.name + '</div>';
            html += '<div class="fleet-driver"><i class="bi bi-person-fill"></i> ' + v.driver + '</div>';
            html += '<div class="fleet-status ' + statusClass + '">' +
                     '<span class="fs-dot"></span>' + statusLabel + '</div>';

            card.innerHTML = html;
            grid.appendChild(card);
        });
    }

    // ============================================================
    //  Timeline Marker Positioning
    // ============================================================
    function positionTimelineMarker() {
        var marker = document.getElementById('timeMarker');
        var bar = document.getElementById('timelineBar');

        // Total shift: 6PM to 6AM = 12 hours
        // Prep: 6PM-9PM = hours 0-3 (25% of bar)
        // Delivery: 9PM-5AM = hours 3-11 (66.67% of bar)
        // Wrapup: 5AM-6AM = hours 11-12 (8.33% of bar)
        //
        // Demo position: 7:30PM = 1.5 hours into shift
        // Percentage: 1.5/12 = 12.5% from right (RTL)
        // In RTL, right = start. We use "right" positioning.

        var totalHours = 12;
        var currentHoursIn = 1.5; // 7:30PM
        var pct = (currentHoursIn / totalHours) * 100;

        // RTL: position from right
        marker.style.right = pct + '%';
        marker.style.left = 'auto';
    }
    </script>

</body>
</html>
